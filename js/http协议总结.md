### http协议总结

#### 1.HTTP一次请求的完整过程



![img](https://upload-images.jianshu.io/upload_images/8669504-fdfa8b382f574bb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/399)

1. 客户端与服务端建立TCP连接
2. 通过TCP套接字连接，发送HTTP请求
3. 服务器解析请求，定位请求资源，将查询资源然后返回HTML文本数据，由客户端读取。
4. 释放TCP连接
5. 客户端浏览器解析HTML内容

#### 2.http协议定义：

协议是指计算机通信网络中两台计算机之间进行通信所必须共同遵守的规定或规则，**超文本传输协议**（**HyperText Transfer Protocol**），缩写**HTTP**。超文本传输协议(HTTP)是一种通信协议通过HTTP或者HTTPS协议请求的资源由统一资源标识符（Uniform Resource Identifiers，URI）来标识。由HTTP客户端发起一个请求，创建一个到服务器指定端口（默认是80端口）的TCP连接。HTTP服务器则在那个端口监听客户端的请求。一旦收到请求，服务器会向客户端返回一个状态，比如"HTTP/1.1 200 OK"，以及返回的内容，如请求的文件、错误消息、或者其它信息。HTTP是一个属于应用层的面向对象的协议。它允许将超文本标记语言(HTML)文档从Web服务器传送到客户端的浏览器。

#### 3.HTTP协议的主要特点可概括如下：

 1.支持c/s和b/s模式。

 2.简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。

 3.灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。

 4.无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。

 5.无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

#### 4.URI和URL

- **URI**：Uniform Resource Identifier，统一资源标识符
  Web上可用的每种资源如HTML文档、图像、视频片段、程序等都是用URI来定位的；
  URI一般由三部分组成：

1. 访问资源的命名机制
2. 存放资源的主机名
3. 资源自身的名称，由路径表示，着重强调于资源

- **URL**：Uniform Resource Location，统一资源定位符
  URL是Internet上用来描述信息资源的字符串，主要用在各种WWW客户程序和服务器程序上。URL是URI的一种。
  采用URL可以用一种统一的格式来描述各种信息资源，包括文件、服务器的地址和目录等。
  URL一般由三部组成

1. 协议
2. 可访问该资源的主机IP地址（或带有端口号）
3. 主机资源的具体地址（目录加文件名）

**URL**的构成：

1. 协议部分：协议部分为http:
2. 域名部分：域名部分例如"[www.jianshu.com](https://www.jianshu.com)"，当然域名也可以用IP地址，IP少一步用DNS服务器解析
3. 端口部分：域名和端口之间使用":"分隔。端口不是URL必须的部分，如果端口省略，将采用默认端口号80，所以实际请求地址是[http://www.jianshu.com:80](https://www.jianshu.com:80)
   4.虚拟目录部分：从域名后的第一个“/”开始到最后一个“/”为止，是虚拟目录部分。虚拟目录也不是一个URL必须的部分。
4. 文件名部分：指在服务器中访问的资源文件的路径。
5. 锚部分：从“#”开始到最后，都是锚部分，也不是必须的部分。做过html的都知道，用于定位到页面的滑动位置。
6. 参数部分：从“？”开始到“#”为止之间的部分为参数部分，又称搜索部分、查询部分。例如？page=1。

#### 5.请求的种类：

HTTP协议中共定义了八种方法或者叫“动作”来表明对Request-URI指定的资源的不同操作方式。就类似操作数据库和文件系统一样，设计网络的请求也是一样。URL用于定位了网络资源，创造PUT,DELETE,POST,GET来对应增，删，改，查操作。但是我们在实际应用中常用的也就是get和post，其他请求方式也都可以通过这两种方式间接的来实现。

- GET
  向指定资源发出“显示“信息。使用GET方法只用于获取数据，而不应该改变数据本身，即不对数据进行操作和提交信息。
- POST
  向指定资源提交数据，请求服务器进行处理（例如提交参数/表单，或者上传文件）。可能会对数据进行操作和提交信心，创建资源。
- PUT
  向指定资源位置上传其最新内容。
- DELETE
  顾名思义，请求服务器删除URI所对应的资源。
- HEAD
  与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。
- TRACE
  回显服务器收到的请求，主要用于测试或诊断。
- OPTIONS
  这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用'*'来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。
- CONNECT
  HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。通常用于SSL加密服务器的链接（经由非加密的HTTP代理服务器）。

#### 6.GET和POST的区别：

1. 参数携带位置不同。
   GET提交的数据会附加家URL之后（即把数据放在请求行中），会在地址栏中显示，接？=传值，多个参数用&连接。POST提交的数据放在HTTP包体中，地址栏不显示。
2. 传输数据大小限制不同。
   不同浏览器对URL的长度有限制，因此对于GET提交时，传输数据就会受到URL长度的限制。POST由于不是通过URL传值，理论上数据不受限。
3. POST的安全性要比GET的安全性高。因为浏览器可能对请求地址做历史记录的存储，对于GET请求的登录，那其他人就可以直接在URL上拿到你的账号和密码了，而POST拿不到参数。

#### 7.HTTP请求信息：

客户端发送一个HTTP请求到服务的请求信息包括以下格式：
请求行（request line）、请求头（header，常用于存放token）、空行和请求数据四个部分。

![img](http://upload-images.jianshu.io/upload_images/8669504-0e15134bd7d27bb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/660)

image.png

例如：

> GET /8669504-c2641e8e6eed5904.png HTTP/1.1
> Host    [www.jianshu.com](https://www.jianshu.com)
> User-Agent    Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36
> Accept    image/webp,image/*,*/*;q=0.8
> Referer  [www.jianshu.com](https://www.jianshu.com)
> Accept-Encoding    gzip, deflate, sdch
> Accept-Language    zh-CN,zh;q=0.8
> name=Professional%20Ajax&publisher=lili

1. 第一行请求行，用来说明请求类型，要访问的资源以及所使用的HTTP版本。
2. 第二部分，大括号之间的请求头部，用于提交服务器的附加信息。
3. 第三部分，空行，请求头部后面的空行是必须的。
4. 第四部分，请求数据也叫主体，可以添加任意的其他数据。

#### 8.HTTP响应信息：

服务器接受请求回传响应信息也由四分部组成：
状态行，消息报头，空行和响应正文。
例如：

> HTTP/1.1 200 OK
> Date: Fri, 22 May 2017 06:07:21 GMT
> Content-Type: text/html; charset=UTF-8
> <html>
> <head></head>
> <body>
> </body>
> </html>

1. 第一行包括协议版本号，返回状态码
2. 第二行为响应日期时间
3. 第三行为响应消息报头，Content-Type:指定了MIME类型的HTML(text/html),编码类型是UTF-8
4. 响应正文，服务器返回给客户端的文本信息。

#### 9.HTTP状态码：

状态码有三位数字，第一数字表示当前相应的类型，各个类型有：

- 1xx消息——请求已被服务器接受，继续处理
- 2xx成功——请求已成功被服务器接收（如见到就像亲人的200，201）
- 3xx重定向——需要后续操作才能完成这一请求
- 4xx请求错误——请求含有词法错误或无法被执行（如见到就想暴走的404 Not Found）
- 5xx服务器错误——服务器在处理某个正确请求时发生错误（如一见到就想找后台的500）

| 状态码  | 状态码英文名称                         | 中文描述                                     |
| ---- | ------------------------------- | ---------------------------------------- |
| 100  | Continue                        | 继续。[客户端](http://www.dreamdu.com/webbuild/client_vs_server/)应继续其请求 |
| 101  | Switching Protocols             | 切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到HTTP的新版本协议 |
|      |                                 |                                          |
| 200  | OK                              | 请求成功。一般用于GET与POST请求                      |
| 201  | Created                         | 已创建。成功请求并创建了新的资源                         |
| 202  | Accepted                        | 已接受。已经接受请求，但未处理完成                        |
| 203  | Non-Authoritative Information   | 非授权信息。请求成功。但返回的meta信息不在原始的服务器，而是一个副本     |
| 204  | No Content                      | 无内容。服务器成功处理，但未返回内容。在未更新网页的情况下，可确保浏览器继续显示当前文档 |
| 205  | Reset Content                   | 重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域 |
| 206  | Partial Content                 | 部分内容。服务器成功处理了部分GET请求                     |
|      |                                 |                                          |
| 300  | Multiple Choices                | 多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择 |
| 301  | Moved Permanently               | 永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替 |
| 302  | Found                           | 临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI     |
| 303  | See Other                       | 查看其它地址。与301类似。使用GET和POST请求查看             |
| 304  | Not Modified                    | 未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源 |
| 305  | Use Proxy                       | 使用代理。所请求的资源必须通过代理访问                      |
| 306  | Unused                          | 已经被废弃的HTTP状态码                            |
| 307  | Temporary Redirect              | 临时重定向。与302类似。使用GET请求重定向                  |
|      |                                 |                                          |
| 400  | Bad Request                     | 客户端请求的语法错误，服务器无法理解                       |
| 401  | Unauthorized                    | 请求要求用户的身份认证                              |
| 402  | Payment Required                | 保留，将来使用                                  |
| 403  | Forbidden                       | 服务器理解请求客户端的请求，但是拒绝执行此请求                  |
| 404  | Not Found                       | 服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置"您所请求的资源无法找到"的个性页面 |
| 405  | Method Not Allowed              | 客户端请求中的方法被禁止                             |
| 406  | Not Acceptable                  | 服务器无法根据客户端请求的内容特性完成请求                    |
| 407  | Proxy Authentication Required   | 请求要求代理的身份认证，与401类似，但请求者应当使用代理进行授权        |
| 408  | Request Time-out                | 服务器等待客户端发送的请求时间过长，超时                     |
| 409  | Conflict                        | 服务器完成客户端的PUT请求是可能返回此代码，服务器处理请求时发生了冲突     |
| 410  | Gone                            | 客户端请求的资源已经不存在。410不同于404，如果资源以前有现在被永久删除了可使用410代码，网站设计人员可通过301代码指定资源的新位置 |
| 411  | Length Required                 | 服务器无法处理客户端发送的不带Content-Length的请求信息       |
| 412  | Precondition Failed             | 客户端请求信息的先决条件错误                           |
| 413  | Request Entity Too Large        | 由于请求的实体过大，服务器无法处理，因此拒绝请求。为防止客户端的连续请求，服务器可能会关闭连接。如果只是服务器暂时无法处理，则会包含一个Retry-After的响应信息 |
| 414  | Request-URI Too Large           | 请求的URI过长（URI通常为网址），服务器无法处理               |
| 415  | Unsupported Media Type          | 服务器无法处理请求附带的媒体格式                         |
| 416  | Requested range not satisfiable | 客户端请求的范围无效                               |
| 417  | Expectation Failed              | 服务器无法满足Expect的请求头信息                      |
|      |                                 |                                          |
| 500  | Internal Server Error           | 服务器内部错误，无法完成请求                           |
| 501  | Not Implemented                 | 服务器不支持请求的功能，无法完成请求                       |
| 502  | Bad Gateway                     | 充当网关或代理的服务器，从远端服务器接收到了一个无效的请求            |
| 503  | Service Unavailable             | 由于超载或系统维护，服务器暂时的无法处理客户端的请求。延时的长度可包含在服务器的Retry-After头信息中 |
| 504  | Gateway Time-out                | 充当网关或代理的服务器，未及时从远端服务器获取请求                |
| 505  | HTTP Version not supported      | 服务器不支持请求的HTTP协议的版本，无法完成处理                |

###### 浏览器输入网站发生的事件：

1、浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;
2、解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;
3、浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;
4、服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;
5、释放 TCP连接;
6、浏览器将该 html 文本并显示内容;